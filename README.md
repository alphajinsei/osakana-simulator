# 魚の群体シミュレーター (Osakana Simulator)

Boidsアルゴリズムを使用した魚の群体シミュレーションプログラムです。HTML5 Canvasを使って、リアルタイムで群体の動きを表示します。

## 概要

このプロジェクトは、Craig Reynoldsが1986年に提唱したBoidsアルゴリズムを実装した群体シミュレーターです。50匹の魚が画面上を泳ぎ、3つの基本ルール（分離・整列・結合）に従って自然な群体行動を再現します。

## 主な特徴

- **Boidsアルゴリズムの実装**: 分離（Separation）、整列（Alignment）、結合（Cohesion）の3つのルールに基づく群体行動
- **シンプルな描画**: 魚は頭（点）と尾（線）で表現され、軽量で高速な描画を実現
- **リアルタイムシミュレーション**: requestAnimationFrameを使った滑らかなアニメーション
- **トーラス空間**: 画面端から出た魚は反対側から出現し、無限の空間を表現
- **インタラクティブ**: Canvas上をクリックすると、その位置に新しい魚を追加可能

## ファイル構成

```
osakana-simulator/
├── index.html      # メインHTMLファイル（UI・レイアウト）
├── simulator.js    # シミュレーター本体クラス（初期化・更新・描画ループ）
├── fish.js         # 魚クラス（Boidsアルゴリズムの実装）
└── README.md       # このファイル
```

## 実装の詳細

### Fish クラス ([fish.js](fish.js))

各魚は以下のプロパティを持ちます：

- **座標**: `x`, `y` - 画面上の位置
- **速度**: `vx`, `vy` - X方向とY方向の速度
- **描画パラメータ**: 体長、色など

**Boidsアルゴリズムのパラメータ**:
- `separationRadius`: 25px - この距離内の魚から離れる
- `alignmentRadius`: 50px - この距離内の魚と速度を合わせる
- `cohesionRadius`: 50px - この距離内の魚の中心に向かう
- `separationWeight`: 30 - 分離の影響力（最も強い）
- `alignmentWeight`: 1.0 - 整列の影響力
- `cohesionWeight`: 0.5 - 結合の影響力

**主要メソッド**:
- `update()`: 次フレームの座標と速度を計算
- `draw()`: Canvas上に魚を描画
- `separation()`: 近くの魚から離れる力を計算
- `alignment()`: 近くの魚と速度を合わせる力を計算
- `cohesion()`: 近くの魚の中心に向かう力を計算
- `limitSpeed()`: 最大速度制限（暴走防止）

### Simulator クラス ([simulator.js](simulator.js))

シミュレーション全体を管理するクラスです。

**主要機能**:
- 50匹の魚を初期化（ランダムな位置と速度）
- 各フレームですべての魚の状態を更新
- Canvas上にすべての魚を描画
- アニメーションループの管理（`requestAnimationFrame`）
- クリックイベントの処理（クリック位置に新しい魚を追加）
- 魚の数をリアルタイム更新

### UI ([index.html](index.html))

- 800x600のCanvas領域
- ダークテーマのUI（深海をイメージ）
- 魚の数をリアルタイム表示

## 実行方法

1. このディレクトリでHTTPサーバーを起動するか、`index.html`をブラウザで直接開きます
2. 自動的に50匹の魚が泳ぎ始めます
3. Canvas上の任意の場所をクリックすると、その位置に新しい魚が追加されます


## 操作方法

- **クリック**: Canvas上の任意の場所をクリックすると、その位置に新しい魚が生成されます
- 追加された魚は、既存の魚たちと同じBoidsアルゴリズムに従って群体行動を開始します
- 魚の数は画面下部にリアルタイムで表示されます

## 今後の拡張可能性

現在の実装は以下の拡張に対応できる構造になっています：

- 魚の数や速度パラメータの動的変更
- 障害物の追加と回避行動
- 捕食者と被食者の関係
- 魚の種類による異なる行動パターン
- パフォーマンス最適化（空間分割アルゴリズムなど）

## 技術スタック

- **HTML5 Canvas**: 2D描画
- **Vanilla JavaScript**: 依存ライブラリなし
- **ES6 Class構文**: オブジェクト指向設計

## 参考文献

- Craig Reynolds, "Flocks, Herds, and Schools: A Distributed Behavioral Model" (1987)
- [Boids (Wikipedia)](https://en.wikipedia.org/wiki/Boids)